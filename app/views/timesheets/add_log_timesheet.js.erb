$(".flash_notice").empty()
$(".flash_notice").append("<%= j(flash.discard(:notice))%>");
$("#new_log")[0].reset();
var firm_format = $(".current_firm_data").data("timeformat")
console.log(firm_format)
if ($("#calendar").length != 0 ) {
	var field = $("#<%= j(@log.log_date.to_s) %>")
	var prehours_date_mounth = field.attr("data-hours")
	var posthours_date_mounth = parseFloat(prehours_date_mounth) + parseFloat(<%= j( @log.hours.to_s )%>)
	field.empty().append(secondsToString(posthours_date_mounth, firm_format))
	field.css("color", "black" )
	field.css("font-size", "20px")
	field.attr("data-hours", posthours_date_mounth)
}else if($(".week").length != 0){
<% if (Time.now.beginning_of_week.to_date..Time.now.end_of_week.to_date).cover?(@log.log_date) %>
<% if @log.project %>
	if ($(".project_total_<%= j(@log.project.id.to_s)%>").length === 0){
		$(".project_hours").last().before('<%= j(render :partial => "timesheet_project_row", :locals => {:log => @log} )%>')
	}
	var field = $(".project_date_<%= j(@log.project.id.to_s)%>_<%= j(@log.log_date.to_s)%>")
	var total_project = $(".project_total_<%= j(@log.project.id.to_s)%>")
<% else %>
	var field = $(".project_date__<%= j(@log.log_date.to_s)%>")
	var total_project = $(".project_total_")
<% end  %>
var input = $(".log_date_<%= j(@log.log_date.to_s)%>")
input.attr("data-logid",<%= j(@log.id.to_s)%> )
var prehours_total_project = total_project.attr("data-hours")
var prehours_total_date = $(".day_<%= j(@log.log_date.to_s) %>").attr("data-hours")
var prehours_total = $(".timesheet_week_total").attr("data-hours")
var prehours_log = field.attr("data-hours")
var posthours_total_project = parseFloat(prehours_total_project) + parseFloat(<%= j( @log.hours.to_s )%>)
var posthours_total_date = parseFloat(prehours_total_date) + parseFloat(<%= j( @log.hours.to_s )%>)
var posthours_total = parseFloat(prehours_total) + parseFloat(<%= j( @log.hours.to_s )%>)
var posthours = parseFloat(prehours_log) + parseFloat(<%= j( @log.hours.to_s )%>)

$(".day_<%= j(@log.log_date.to_s) %>").empty().append(secondsToString(posthours_total_date, firm_format))
$(".day_<%= j(@log.log_date.to_s) %>").attr("data-hours",posthours_total_date) 
total_project.empty().append(secondsToString(posthours_total_project, firm_format))
total_project.attr("data-hours",posthours_total_project)
$(".timesheet_week_total").empty().append(secondsToString(posthours_total, firm_format))
$(".timesheet_week_total").attr("data-hours",posthours_total)
input.attr("data-prehours", parseFloat(<%= j(@log.hours.to_s) %>))
field.empty().append(secondsToString(posthours, firm_format))
field.attr("data-hours", posthours)
<% end  %>
}else{
	if (window.location.href.split("/").pop() == "<%= @log.log_date.to_s %>")
	{
	$("#head_log").after("<%= escape_javascript(render(:partial => @log)) %>");
	$(".total_log_time").set_hours()
	}
}

$('.spinning').hide();
